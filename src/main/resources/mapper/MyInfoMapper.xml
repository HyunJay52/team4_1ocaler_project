<?xml version="1.0" encoding="UTF-8"?>
<!-- copy from https://mybatis.org/mybatis-3/ko/getting-started.html -->
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.team4.localer.dao.MyInfoDAO">
	
	<select id="setMyinfo" resultType="com.team4.localer.vo.MemberVO">
		select * from member where userid=#{param1}
	</select>
	<select id="goMyinfopage" resultType="com.team4.localer.vo.MemberVO">
		select * from member where userid=#{userid} and userpwd=#{userpwd}
	</select>
	
	<insert id="pointCharge" parameterType="com.team4.localer.vo.Cha_pVO">
		insert into cha_p(userid, cha_point, cha_mth)
		values(#{userid}, #{cha_point}, #{cha_mth})
	</insert>
	
	<select id="joinPoint" resultType="String">
		select sum(cha_point) from cha_p c join member m on c.userid=m.userid 
		where m.userid = #{param1}
	</select>

	<select id="allPointSelect" parameterType="com.team4.localer.vo.MyinfoPageVO" resultType="com.team4.localer.vo.Cha_pVO">
		
		select * from (
		select * from (
		select userid, cha_point, to_char(po_date, 'YYYY-MM-DD HH:MI:SS') po_date, cha_mth from cha_p
		union all
		select userid, sp_point, to_char(sp_date, 'YYYY-MM-DD HH:MI:SS') sp_date, sp_item from sp_p order by po_date desc)
		<![CDATA[where rownum <=#{rowNum1} and userid = #{userid} ]]>
			<if test="searchDate != '' and searchDate != null">
				and po_date between to_char(trunc(to_date(#{searchDate}, 'YYYY-MM-DD HH:MI:SS'), 'MM'), 'YYYY-MM-DD HH:MI:SS')
				and to_char(last_day(to_date(#{searchDate2},'YYYY-MM-DD HH:MI:SS')),'YYYY-MM-DD HH:MI:SS' )							
			</if>
			<if test="searchKey == 1">
				<![CDATA[and cha_mth <= #{searchKey}]]>
			</if>
			<if test="searchKey == 2">
				<![CDATA[and cha_mth >= #{searchKey}]]>
			</if>		
			order by po_date asc)
			<![CDATA[where rownum<=#{rowNum2} ]]>
			order by po_date desc
		
	</select>
	
	<select id="pointCount" parameterType="com.team4.localer.vo.MyinfoPageVO" resultType="String">
		select count(userid) from(
		select * from (
		select userid, cha_mth, to_char(po_date,'YYYY-MM-DD HH:MI:SS') po_date from cha_p
		union all
		select userid, sp_item, to_char(sp_date,'YYYY-MM-DD HH:MI:SS') from sp_p)
		where po_date between to_char(trunc(to_date(#{searchDate}, 'YYYY-MM-DD HH:MI:SS'), 'MM'), 'YYYY-MM-DD HH:MI:SS')
		and to_char(last_day(to_date(#{searchDate2},'YYYY-MM-DD HH:MI:SS')),'YYYY-MM-DD HH:MI:SS' ))
		where userid=#{userid}
		<if test="searchKey != null and searchKey == 1">
		<![CDATA[and cha_mth <= #{searchKey}]]>
		</if>
		<if test="searchKey != null and searchKey == 2">
		<![CDATA[and cha_mth >= #{searchKey}]]>
		</if>
	</select>
</mapper>